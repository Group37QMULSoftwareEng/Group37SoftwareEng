import{i as z}from"./index.f5263518.js";import{c as E,a as W,b as k}from"./coin.cb3c48a8.js";import{w as N,a as O}from"./wallet.49f100df.js";import{_ as T,E as F,c as m,b as s,d as i,e as r,F as f,x as w,m as b,z as y,f as c,o as h,t as _,B as L,y as j,j as p,n as M,p as G,k as J}from"./index.2f24064d.js";import"./request.019d1f39.js";const Z={data(){return{coins:[],rank:[],name:"BTC",walletDataList:[],chargeValue:0,chargeForm:{},chargeVisiable:!1}},setup(){return{formatString:function(a){if(a.length<=8)return a;var e=a.substring(0,4),n=a.substring(a.length-4),C="...";return e+C+n},compare:function(a,e){return console.log(a,e),a<e||a>e?a/e*100-100:0},geticon:function(a){return a<0?"ArrowDown":a>0?"ArrowUp":"SemiSelect"}}},mounted(){this.getCoinList(),this.getCoinRateRankList()},methods:{showChargeBox(o){this.chargeForm=o,this.chargeVisiable=!0},handleCharge(){this.chargeForm.balance=parseFloat(this.chargeValue)+parseFloat(this.chargeForm.balance),console.log(this.chargeForm);let o={id:this.chargeForm.id,balance:this.chargeForm.balance,user_id:this.chargeForm.user_id,name:this.chargeForm.name,hash_id:this.chargeForm.hash_id};N(o).then(l=>{l.code===200?(this.chargeValue=0,this.chargeVisiable=!1,F.success("Purchase success")):F.error("Purchase failed, please try again!")})},getCoinList(){E().then(o=>{o.code===200&&(this.coins=o.data,this.getCoinRateList(),this.getWalletList())})},getCoinRateRankList(){W().then(o=>{o.code===200&&(this.rank=o.data,this.rank.forEach(l=>{l.cur_rate=l.rate.split(",")[0],l.pre_rate=l.rate.split(",")[1]}))})},handleAddWallet(){this.$router.push({name:"CreateWallet"})},async getWalletList(){let o=localStorage.getItem("user");if(!o)return;let l=JSON.parse(o);const d=await O({user_id:l.id,page:1,page_size:100});if(d.code===200){let a=d.data.list;for(const e of a)e.last_rate=await this.getLastRate(e),e.total_money=e.balance*this.coins.find(n=>n.id===e.coin_id).rate;a.sort((e,n)=>n.total_money-e.total_money),this.walletDataList=a.slice(0,3)}else console.log("Get user wallet list failed, please try again!")},getCoinRateList(){let o=document.getElementById("chart1");o.removeAttribute("_echarts_instance_");let l=z(o),d={dataZoom:[{type:"inside"}],tooltip:{trigger:"axis"},xAxis:{data:[]},yAxis:{},series:[{name:"Exchange Rate (USD)",type:"line",data:[]}]};k({name:this.name}).then(a=>{if(a.code===200){let e=a.data.slice(-10);d.xAxis.data=e.map(n=>n.date),d.series[0].data=e.map(n=>n.rate)}l.setOption(d)})},async getLastRate(o){let l=this.coins.find(n=>n.id===o.coin_id),d=l.rate,a=l.name;const e=await k({name:a});if(e.code===200)return console.log(d-e.data[e.data.length-2].rate),(d-e.data[e.data.length-2].rate)*o.balance}}},g=o=>(G("data-v-1939dc5b"),o=o(),J(),o),q={class:"echart-container"},H={class:"echart-item-left"},K={class:"title"},Q=g(()=>s("div",{class:"left"}," CryptoCurrency ",-1)),X={class:"right"},Y=g(()=>s("hr",{class:"hr"},null,-1)),$=g(()=>s("div",{class:"echart-canvas",id:"chart1"},null,-1)),ee={class:"echart-item-right"},te=g(()=>s("div",{class:"echart-item-right-row"},"The Five Most Popular Cryptocurrencies",-1)),ae={class:"echart-item-right-row"},se={class:"currency"},oe={class:"rate"},le={class:"updown"},ne={key:0,class:"wallet-container"},re=g(()=>s("div",{class:"add-desc"}," Add Wallet ",-1)),ie={class:"card-header"},ce={class:"wallet-name-avatar"},de={class:"avatar"},_e={class:"wallet-name-balance"},he={class:"wallet-name"},ue={class:"balance"},me={class:"wallet-address"},pe={class:"second"},ge={class:"card-text"};function fe(o,l,d,a,e,n){const C=c("el-option"),R=c("el-select"),v=c("el-icon"),S=c("Plus"),x=c("el-card"),A=c("el-avatar"),D=c("Coin"),B=c("el-input"),I=c("el-form-item"),P=c("el-form"),V=c("el-button"),U=c("el-dialog");return h(),m(f,null,[s("div",q,[s("div",H,[s("div",K,[Q,s("div",X,[i(R,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.name=t),onChange:n.getCoinRateList,placeholder:"Select Currency",filterable:"",clearable:"",style:{width:"240px"}},{default:r(()=>[(h(!0),m(f,null,w(e.coins,t=>(h(),b(C,{key:t.name,label:t.name+" - "+t.rate+"(USD)",value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])])]),Y,$]),s("div",ee,[te,(h(!0),m(f,null,w(e.rank,t=>(h(),m("div",ae,[s("div",se,_(t.name),1),s("div",oe," $"+_(t.cur_rate),1),s("div",le,[s("div",{class:L(t.cur_rate>t.pre_rate?"up":"down")},[i(v,null,{default:r(()=>[(h(),b(j(a.geticon(a.compare(t.cur_rate,t.pre_rate)))))]),_:2},1024),p(" "+_(a.compare(t.cur_rate,t.pre_rate).toFixed(2))+"% ",1)],2)])]))),256))])]),this.$store.state.user.role===1?(h(),m("div",ne,[e.walletDataList.length===0?(h(),b(x,{key:0,class:"wallet-item add-wallet",onClick:n.handleAddWallet},{default:r(()=>[s("div",null,[i(v,{color:"#b9b3b3",size:30},{default:r(()=>[i(S)]),_:1})]),re]),_:1},8,["onClick"])):y("",!0),e.walletDataList.length>0?(h(!0),m(f,{key:1},w(e.walletDataList,t=>(h(),b(x,{class:"wallet-item",style:M({backgroundColor:"rgb(73 78 86)"})},{header:r(()=>[s("div",ie,[s("div",ce,[s("div",de,[i(A,{size:50},{default:r(()=>[p(_(e.coins.find(u=>u.id===t.coin_id).name),1)]),_:2},1024)]),s("div",_e,[s("div",he,_(t.name),1),s("div",ue,_(t.balance)+" "+_(e.coins.find(u=>u.id===t.coin_id).name),1)])]),s("div",me,[s("div",{class:L(t.last_rate>0?"top":"bottom")}," ("+_(t.last_rate>0?"+":"")+" "+_(t.last_rate.toFixed(2))+") ",3),s("div",pe,[p(" $"+_((t.balance*e.coins.find(u=>u.id===t.coin_id).rate).toFixed(2))+" ",1),i(v,{onClick:u=>n.showChargeBox(t)},{default:r(()=>[i(D)]),_:2},1032,["onClick"])])])])]),default:r(()=>[s("p",ge,_(t.description),1)]),_:2},1032,["style"]))),256)):y("",!0)])):y("",!0),i(U,{title:"Purchase",modelValue:e.chargeVisiable,"onUpdate:modelValue":l[3]||(l[3]=t=>e.chargeVisiable=t),width:"25%"},{footer:r(()=>[i(V,{type:"primary",onClick:n.handleCharge},{default:r(()=>[p("Confirm")]),_:1},8,["onClick"]),i(V,{onClick:l[2]||(l[2]=t=>e.chargeVisiable=!1)},{default:r(()=>[p("Cancel")]),_:1})]),default:r(()=>[i(P,{model:e.chargeForm,"label-width":"70px",ref:"chargeFormRef"},{default:r(()=>[i(I,{label:"Amount",prop:"balance"},{default:r(()=>[i(B,{modelValue:e.chargeValue,"onUpdate:modelValue":l[1]||(l[1]=t=>e.chargeValue=t),placeholder:"Purchase amount"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}const xe=T(Z,[["render",fe],["__scopeId","data-v-1939dc5b"]]);export{xe as default};
